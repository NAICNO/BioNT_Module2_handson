

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Unsupervised Learning &mdash; Applied ML for Biological Data - Hands-on sessions  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_lesson.css?v=e9df6548" />
      <link rel="stylesheet" type="text/css" href="../_static/term_role_formatting.css?v=4194e21c" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_rtd_theme_ext_color_contrast.css?v=8e8ea19f" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=187304be"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=35a8b989"></script>
      <script src="../_static/minipres.js?v=a0d29692"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Classification" href="../2.Notebook_Logistic_regression/" />
    <link rel="prev" title="DeepVariant: Deep-learning tool" href="../4.DeepVariant/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../" class="icon icon-home">
            Applied ML for Biological Data - Hands-on sessions
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Sessions descriptions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../1.PCA_n_Clustering/">Unsupervised Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2.Logistic_regression/">Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3.ML_workflow/">Complete Machine Learning Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4.DeepVariant/">DeepVariant: Deep-learning tool</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Jupyter Notebooks</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Unsupervised Learning</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#principal-component-analysis-pca-and-k-means-clustering">Principal component analysis (PCA) and K-means clustering</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-preparation">Data Preparation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dimensionality-of-the-datasets">Dimensionality of the datasets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#clean-the-dataset-by-handling-missing-values">Clean the dataset by handling missing values</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#variance-plots">Variance plots</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#normalize-the-data-standardization">Normalize the data (Standardization)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pca-implementation">PCA Implementation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#apply-pca-transformation">Apply PCA transformation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pca-context">PCA context</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#explained-variance">Explained variance:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#visualize-the-explained-variance">Visualize the explained variance</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#determine-optimal-number-of-components">Determine optimal number of components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#variance-threshold">Variance Threshold</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scree-plot">Scree Plot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#automated-selection-with-pca">Automated Selection with PCA</a></li>
<li class="toctree-l2"><a class="reference internal" href="#feature-loadings">Feature Loadings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#visualization-feature-loadings">Visualization - Feature Loadings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#k-means-cluster-analysis">K-means Cluster analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#inertia-within-cluster-sum-of-squares">Inertia (within-cluster sum-of-squares)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-elbow-method">The Elbow Method</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#silhouette-score">Silhouette Score</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interpretation-of-silhouette-score">Interpretation of Silhouette Score</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#finding-optimal-k-using-silhouette">Finding Optimal K Using Silhouette</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../2.Notebook_Logistic_regression/">Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3.Notebook_ML_workflow/">Complete ML workflow</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Q &amp; A sessions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../1.PCA_n_clustering_QnA/">Unsupervised Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2.Logistic_regression_QnA/">Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3.ML_workflow_QnA/">Complete Machine Learning Workflow</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">Applied ML for Biological Data - Hands-on sessions</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Unsupervised Learning</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/coderefinery/content/blob/main/content/1.Notebook_PCA_n_Clustering_session.ipynb" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="unsupervised-learning">
<h1>Unsupervised Learning<a class="headerlink" href="#unsupervised-learning" title="Link to this heading"></a></h1>
<section id="principal-component-analysis-pca-and-k-means-clustering">
<h2>Principal component analysis (PCA) and K-means clustering<a class="headerlink" href="#principal-component-analysis-pca-and-k-means-clustering" title="Link to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.decomposition</span><span class="w"> </span><span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.cluster</span><span class="w"> </span><span class="kn">import</span> <span class="n">KMeans</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">silhouette_score</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-preparation">
<h2>Data Preparation<a class="headerlink" href="#data-preparation" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Clean the dataset by handling missing values</p></li>
<li><p>Scale/normalize the data</p></li>
<li><p>Check for outliers</p></li>
<li><p>Separate metadata from drug sensitivity values</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>curl<span class="w"> </span>https://naicno.github.io/BioNT_Module2_handson/_downloads/d10b2868b0538b6d8e941c3b4de06a4c/BRCA_Drug_sensitivity_test_data.csv<span class="w"> </span>-o<span class="w"> </span>BRCA_Drug_sensitivity_test_data.csv
<span class="o">!</span><span class="w"> </span>ls<span class="w"> </span>-lh<span class="w"> </span>BRCA_Drug_sensitivity_test_data.csv
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100 18108  100 18108    0     0   113k      0 --:--:-- --:--:-- --:--:--  113k
100 18108  100 18108    0     0   113k      0 --:--:-- --:--:-- --:--:--  113k
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-rw-r--r-- 1 runner docker 18K Jun 10 13:52 BRCA_Drug_sensitivity_test_data.csv
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;BRCA_Drug_sensitivity_test_data.csv&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Patient ID</th>
      <th>bendamustine</th>
      <th>ML320</th>
      <th>BRD-K14844214</th>
      <th>leptomycin B</th>
      <th>Compound 23 citrate</th>
      <th>BRD4132</th>
      <th>dabrafenib</th>
      <th>necrosulfonamide</th>
      <th>PF-543</th>
      <th>...</th>
      <th>Compound 1541A</th>
      <th>pevonedistat</th>
      <th>ISOX</th>
      <th>tosedostat</th>
      <th>AT13387</th>
      <th>BRD-A02303741</th>
      <th>BRD-K99006945</th>
      <th>GSK525762A</th>
      <th>necrostatin-7</th>
      <th>nakiterpiosin</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>TCGA-D8-A1JU</td>
      <td>14.821152</td>
      <td>14.286200</td>
      <td>14.608184</td>
      <td>4.960653</td>
      <td>13.530885</td>
      <td>13.202820</td>
      <td>13.879099</td>
      <td>12.839373</td>
      <td>14.103941</td>
      <td>...</td>
      <td>14.778758</td>
      <td>12.541663</td>
      <td>12.113460</td>
      <td>12.364817</td>
      <td>8.913646</td>
      <td>14.860838</td>
      <td>13.170200</td>
      <td>13.116395</td>
      <td>14.548597</td>
      <td>11.835573</td>
    </tr>
    <tr>
      <th>1</th>
      <td>TCGA-AC-A3QQ</td>
      <td>14.304843</td>
      <td>14.333355</td>
      <td>14.960661</td>
      <td>3.552977</td>
      <td>13.122806</td>
      <td>13.129905</td>
      <td>13.911525</td>
      <td>12.124210</td>
      <td>14.127482</td>
      <td>...</td>
      <td>15.108698</td>
      <td>10.936052</td>
      <td>11.802052</td>
      <td>11.893495</td>
      <td>8.326862</td>
      <td>15.265313</td>
      <td>15.341146</td>
      <td>13.509974</td>
      <td>14.311074</td>
      <td>10.772699</td>
    </tr>
    <tr>
      <th>2</th>
      <td>TCGA-C8-A12Q</td>
      <td>14.658052</td>
      <td>14.649223</td>
      <td>14.547810</td>
      <td>3.467945</td>
      <td>13.438683</td>
      <td>13.441228</td>
      <td>13.823993</td>
      <td>12.935296</td>
      <td>14.052508</td>
      <td>...</td>
      <td>15.012134</td>
      <td>12.837987</td>
      <td>11.944058</td>
      <td>11.694113</td>
      <td>8.622052</td>
      <td>15.205567</td>
      <td>14.039701</td>
      <td>13.252381</td>
      <td>14.496764</td>
      <td>11.387851</td>
    </tr>
    <tr>
      <th>3</th>
      <td>TCGA-AR-A1AY</td>
      <td>14.342911</td>
      <td>13.657840</td>
      <td>14.426898</td>
      <td>1.800027</td>
      <td>13.242654</td>
      <td>13.094447</td>
      <td>13.531232</td>
      <td>11.987928</td>
      <td>14.046877</td>
      <td>...</td>
      <td>14.811534</td>
      <td>11.098317</td>
      <td>11.480102</td>
      <td>11.379716</td>
      <td>8.080488</td>
      <td>14.906361</td>
      <td>13.462326</td>
      <td>13.030773</td>
      <td>14.466555</td>
      <td>9.665608</td>
    </tr>
    <tr>
      <th>4</th>
      <td>TCGA-A8-A0A2</td>
      <td>14.655920</td>
      <td>14.323148</td>
      <td>14.527811</td>
      <td>4.491210</td>
      <td>13.293485</td>
      <td>13.054068</td>
      <td>13.807173</td>
      <td>12.446720</td>
      <td>14.012040</td>
      <td>...</td>
      <td>14.816099</td>
      <td>12.075367</td>
      <td>11.878005</td>
      <td>11.800027</td>
      <td>8.595326</td>
      <td>14.988143</td>
      <td>14.074985</td>
      <td>12.959710</td>
      <td>14.435152</td>
      <td>11.143563</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 51 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset shape: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Patient IDs: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Patient ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span><span class="si">}</span><span class="s2"> unique values&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Features: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s2"> drug sensitivity measurements&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset shape: (25, 51)
Patient IDs: 25 unique values
Features: 50 drug sensitivity measurements
</pre></div>
</div>
</div>
</div>
<section id="dimensionality-of-the-datasets">
<h3>Dimensionality of the datasets<a class="headerlink" href="#dimensionality-of-the-datasets" title="Link to this heading"></a></h3>
<p><strong>Notes: High-dimensional data</strong></p>
<ul class="simple">
<li><p>High-dimensional data refers to datasets where the number of features or attributes (dimensions, denoted as p) is significantly large</p></li>
<li><p>In such datasets, each observation can be thought of as residing in a high-dimensional space</p></li>
<li><p>The definition of “high-dimensional” data can vary depending on the context, the field of study, and the specific analysis being performed.</p></li>
</ul>
<p><em><strong>Dataset with 51 columns (drug compounds) and 25 rows (patients):</strong></em></p>
<ul class="simple">
<li><p>Contains more features (50 drug sensitivity scores) than samples (25 patients)</p></li>
<li><p><em>Difficulty in Visualization:</em> Identifying patterns visually becomes impossible</p></li>
<li><p><em>Sparsity:</em> With 50 features but only 25 samples, data points are scattered across a vast 50-dimensional space</p></li>
<li><p><em>Distance metrics become less meaningful:</em> In high dimensions, the difference between the nearest and farthest neighbors becomes less significant - nearly all points appear similar-distances from each other</p></li>
<li><p><em>Overfitting risk:</em> model has many potential combinations of features to consider, but limited examples to learn from, it has a large capacity to fit even noise in the limited training examples leading to overfitting and poor performance</p></li>
</ul>
</section>
<section id="clean-the-dataset-by-handling-missing-values">
<h3>Clean the dataset by handling missing values<a class="headerlink" href="#clean-the-dataset-by-handling-missing-values" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check for missing values</span>
<span class="n">data</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.int64(0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check data types</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data types:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Datatypes of first 10 columns:&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">dtypes</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Different datatypes in the dataframe:&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Patient ID&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data types:
Datatypes of first 10 columns: Patient ID              object
bendamustine           float64
ML320                  float64
BRD-K14844214          float64
leptomycin B           float64
Compound 23 citrate    float64
BRD4132                float64
dabrafenib             float64
necrosulfonamide       float64
PF-543                 float64
dtype: object
Different datatypes in the dataframe: [dtype(&#39;float64&#39;)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Basic statistics for drug sensitivity values</span>
<span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>unique</th>
      <th>top</th>
      <th>freq</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>myricetin</th>
      <td>25.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>15.126359</td>
      <td>0.043691</td>
      <td>15.053067</td>
      <td>15.095327</td>
      <td>15.120994</td>
      <td>15.151308</td>
      <td>15.219127</td>
    </tr>
    <tr>
      <th>BRD-A02303741</th>
      <td>25.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>15.058701</td>
      <td>0.163287</td>
      <td>14.70386</td>
      <td>14.96314</td>
      <td>15.036734</td>
      <td>15.205567</td>
      <td>15.398952</td>
    </tr>
    <tr>
      <th>Compound 1541A</th>
      <td>25.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>14.907687</td>
      <td>0.136504</td>
      <td>14.724434</td>
      <td>14.811534</td>
      <td>14.879828</td>
      <td>14.981904</td>
      <td>15.318321</td>
    </tr>
    <tr>
      <th>carboplatin</th>
      <td>25.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>14.711186</td>
      <td>0.135093</td>
      <td>14.459443</td>
      <td>14.623642</td>
      <td>14.671899</td>
      <td>14.799047</td>
      <td>14.999075</td>
    </tr>
    <tr>
      <th>BRD-K27188169</th>
      <td>25.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>14.624495</td>
      <td>0.086419</td>
      <td>14.428273</td>
      <td>14.601246</td>
      <td>14.623367</td>
      <td>14.67901</td>
      <td>14.801653</td>
    </tr>
    <tr>
      <th>BRD-K14844214</th>
      <td>25.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>14.610919</td>
      <td>0.1589</td>
      <td>14.393664</td>
      <td>14.519765</td>
      <td>14.597586</td>
      <td>14.681205</td>
      <td>15.019018</td>
    </tr>
    <tr>
      <th>pifithrin-mu</th>
      <td>25.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>14.589748</td>
      <td>0.267786</td>
      <td>14.076076</td>
      <td>14.384124</td>
      <td>14.600936</td>
      <td>14.790655</td>
      <td>15.095189</td>
    </tr>
    <tr>
      <th>RO4929097</th>
      <td>25.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>14.559876</td>
      <td>0.181499</td>
      <td>13.979993</td>
      <td>14.480718</td>
      <td>14.59874</td>
      <td>14.66368</td>
      <td>14.924847</td>
    </tr>
    <tr>
      <th>RG-108</th>
      <td>25.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>14.447688</td>
      <td>0.218108</td>
      <td>13.95736</td>
      <td>14.283119</td>
      <td>14.4542</td>
      <td>14.592225</td>
      <td>14.81662</td>
    </tr>
    <tr>
      <th>bendamustine</th>
      <td>25.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>14.447378</td>
      <td>0.341383</td>
      <td>13.492308</td>
      <td>14.304843</td>
      <td>14.46329</td>
      <td>14.658052</td>
      <td>15.100501</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>unique</th>
      <th>top</th>
      <th>freq</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>nakiterpiosin</th>
      <td>25.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>10.90167</td>
      <td>0.831147</td>
      <td>8.701056</td>
      <td>10.381886</td>
      <td>11.26099</td>
      <td>11.37343</td>
      <td>11.92009</td>
    </tr>
    <tr>
      <th>YM-155</th>
      <td>25.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>10.166452</td>
      <td>0.883099</td>
      <td>7.774662</td>
      <td>9.441895</td>
      <td>10.42738</td>
      <td>10.774703</td>
      <td>11.398507</td>
    </tr>
    <tr>
      <th>NVP-BEZ235</th>
      <td>25.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>9.83664</td>
      <td>0.38227</td>
      <td>8.935818</td>
      <td>9.616815</td>
      <td>9.876253</td>
      <td>10.104948</td>
      <td>10.476573</td>
    </tr>
    <tr>
      <th>belinostat</th>
      <td>25.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>9.719361</td>
      <td>0.630235</td>
      <td>8.049804</td>
      <td>9.406909</td>
      <td>9.762903</td>
      <td>9.957621</td>
      <td>11.005536</td>
    </tr>
    <tr>
      <th>pluripotin</th>
      <td>25.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>9.469802</td>
      <td>0.687683</td>
      <td>7.503132</td>
      <td>9.085914</td>
      <td>9.568229</td>
      <td>9.910524</td>
      <td>10.704892</td>
    </tr>
    <tr>
      <th>MLN2238</th>
      <td>25.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>8.930093</td>
      <td>0.741736</td>
      <td>7.218104</td>
      <td>8.485371</td>
      <td>9.008484</td>
      <td>9.357212</td>
      <td>10.017931</td>
    </tr>
    <tr>
      <th>KX2-391</th>
      <td>25.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>8.798709</td>
      <td>1.396529</td>
      <td>5.071334</td>
      <td>7.925459</td>
      <td>9.349282</td>
      <td>9.607232</td>
      <td>10.796027</td>
    </tr>
    <tr>
      <th>AT13387</th>
      <td>25.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>8.378987</td>
      <td>0.764056</td>
      <td>6.576897</td>
      <td>8.046521</td>
      <td>8.281312</td>
      <td>8.913646</td>
      <td>9.612334</td>
    </tr>
    <tr>
      <th>leptomycin B</th>
      <td>25.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.473396</td>
      <td>1.242517</td>
      <td>0.864948</td>
      <td>2.824049</td>
      <td>3.549045</td>
      <td>4.49121</td>
      <td>5.194158</td>
    </tr>
    <tr>
      <th>Patient ID</th>
      <td>25</td>
      <td>25</td>
      <td>TCGA-D8-A1JU</td>
      <td>1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 2: Exploratory Data Analysis</span>
<span class="k">def</span><span class="w"> </span><span class="nf">perform_eda</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Exploratory Data Analysis ===&quot;</span><span class="p">)</span>
    <span class="c1"># Separate metadata from drug sensitivity values</span>
    <span class="n">drug_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Patient ID&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># Distribution of drug sensitivity values</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">drug_data</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of Drug Sensitivity Values&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Sensitivity Value&#39;</span><span class="p">)</span>
    
    <span class="c1"># Boxplot of drug sensitivity values (first 10 drugs)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">drug_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">10</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Boxplot of First 10 Drugs&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">drug_data</span>
 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drug_data</span> <span class="o">=</span> <span class="n">perform_eda</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== Exploratory Data Analysis ===
</pre></div>
</div>
<img alt="../_images/f625cf5f35c1cc46b3951a3b581a7de7562252810bcb221afa8ef1b829e2fce3.png" src="../_images/f625cf5f35c1cc46b3951a3b581a7de7562252810bcb221afa8ef1b829e2fce3.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drug_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bendamustine</th>
      <th>ML320</th>
      <th>BRD-K14844214</th>
      <th>leptomycin B</th>
      <th>Compound 23 citrate</th>
      <th>BRD4132</th>
      <th>dabrafenib</th>
      <th>necrosulfonamide</th>
      <th>PF-543</th>
      <th>KX2-391</th>
      <th>...</th>
      <th>Compound 1541A</th>
      <th>pevonedistat</th>
      <th>ISOX</th>
      <th>tosedostat</th>
      <th>AT13387</th>
      <th>BRD-A02303741</th>
      <th>BRD-K99006945</th>
      <th>GSK525762A</th>
      <th>necrostatin-7</th>
      <th>nakiterpiosin</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>14.821152</td>
      <td>14.286200</td>
      <td>14.608184</td>
      <td>4.960653</td>
      <td>13.530885</td>
      <td>13.202820</td>
      <td>13.879099</td>
      <td>12.839373</td>
      <td>14.103941</td>
      <td>10.796027</td>
      <td>...</td>
      <td>14.778758</td>
      <td>12.541663</td>
      <td>12.113460</td>
      <td>12.364817</td>
      <td>8.913646</td>
      <td>14.860838</td>
      <td>13.170200</td>
      <td>13.116395</td>
      <td>14.548597</td>
      <td>11.835573</td>
    </tr>
    <tr>
      <th>1</th>
      <td>14.304843</td>
      <td>14.333355</td>
      <td>14.960661</td>
      <td>3.552977</td>
      <td>13.122806</td>
      <td>13.129905</td>
      <td>13.911525</td>
      <td>12.124210</td>
      <td>14.127482</td>
      <td>8.489440</td>
      <td>...</td>
      <td>15.108698</td>
      <td>10.936052</td>
      <td>11.802052</td>
      <td>11.893495</td>
      <td>8.326862</td>
      <td>15.265313</td>
      <td>15.341146</td>
      <td>13.509974</td>
      <td>14.311074</td>
      <td>10.772699</td>
    </tr>
    <tr>
      <th>2</th>
      <td>14.658052</td>
      <td>14.649223</td>
      <td>14.547810</td>
      <td>3.467945</td>
      <td>13.438683</td>
      <td>13.441228</td>
      <td>13.823993</td>
      <td>12.935296</td>
      <td>14.052508</td>
      <td>9.349282</td>
      <td>...</td>
      <td>15.012134</td>
      <td>12.837987</td>
      <td>11.944058</td>
      <td>11.694113</td>
      <td>8.622052</td>
      <td>15.205567</td>
      <td>14.039701</td>
      <td>13.252381</td>
      <td>14.496764</td>
      <td>11.387851</td>
    </tr>
    <tr>
      <th>3</th>
      <td>14.342911</td>
      <td>13.657840</td>
      <td>14.426898</td>
      <td>1.800027</td>
      <td>13.242654</td>
      <td>13.094447</td>
      <td>13.531232</td>
      <td>11.987928</td>
      <td>14.046877</td>
      <td>7.385516</td>
      <td>...</td>
      <td>14.811534</td>
      <td>11.098317</td>
      <td>11.480102</td>
      <td>11.379716</td>
      <td>8.080488</td>
      <td>14.906361</td>
      <td>13.462326</td>
      <td>13.030773</td>
      <td>14.466555</td>
      <td>9.665608</td>
    </tr>
    <tr>
      <th>4</th>
      <td>14.655920</td>
      <td>14.323148</td>
      <td>14.527811</td>
      <td>4.491210</td>
      <td>13.293485</td>
      <td>13.054068</td>
      <td>13.807173</td>
      <td>12.446720</td>
      <td>14.012040</td>
      <td>9.540638</td>
      <td>...</td>
      <td>14.816099</td>
      <td>12.075367</td>
      <td>11.878005</td>
      <td>11.800027</td>
      <td>8.595326</td>
      <td>14.988143</td>
      <td>14.074985</td>
      <td>12.959710</td>
      <td>14.435152</td>
      <td>11.143563</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 50 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">drug_data</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/0b2e89e686c2a1c801a0d73182520d92f7f236436a095b645a46a48333ed1525.png" src="../_images/0b2e89e686c2a1c801a0d73182520d92f7f236436a095b645a46a48333ed1525.png" />
</div>
</div>
<section id="variance-plots">
<h4>Variance plots<a class="headerlink" href="#variance-plots" title="Link to this heading"></a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">variances</span> <span class="o">=</span> <span class="n">drug_data</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">variances</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">variances</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Variance Across Columns&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Variance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/657a95d374dc9c19d317f03850231025848bb9fdada4d05751a2838f9042a92c.png" src="../_images/657a95d374dc9c19d317f03850231025848bb9fdada4d05751a2838f9042a92c.png" />
</div>
</div>
</section>
</section>
<section id="normalize-the-data-standardization">
<h3>Normalize the data (Standardization)<a class="headerlink" href="#normalize-the-data-standardization" title="Link to this heading"></a></h3>
<p><strong>PCA is sensitive to the variances of the original features</strong>, therefore data normalization before applying PCA is crucial</p>
<ul class="simple">
<li><p>PCA works by identifying the directions (principal components) that capture the maximum variance in the data.</p></li>
<li><p>Variables with larger variances can dominate the principal components</p>
<ul>
<li><p>This means the principal components might primarily reflect the variability of the features with the largest ranges</p></li>
<li><p>principal components do not capture the underlying relationships in the data</p></li>
</ul>
</li>
<li><p>Drugs with inherently higher variability in their sensitivity scores would disproportionately influence the principal components, potentially masking the contributions and relationships involving drugs with lower score variability.</p></li>
</ul>
<p>PCA looks for directions of maximum variance, standardization ensures that each feature contributes more equally to the determination of the principal components</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the scaler and standardize the data</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">drug_data</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">drug_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Type of drug_data:&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">drug_data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shape of drug_data:&quot;</span><span class="p">,</span> <span class="n">drug_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First 5 rows and columns of drug_data:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">drug_data</span><span class="p">[:</span><span class="mi">5</span><span class="p">,</span> <span class="p">:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Type of drug_data: &lt;class &#39;numpy.ndarray&#39;&gt;
Shape of drug_data: (25, 50)
First 5 rows and columns of drug_data:
 [[ 1.11745915 -0.14919196 -0.01756464  1.22165355  0.70067562]
 [-0.4261314  -0.02638244  2.24640919  0.06536914 -0.66625469]
 [ 0.62984536  0.7962644  -0.40535119 -0.00447747  0.3918278 ]
 [-0.3123208  -1.78569382 -1.18197636 -1.3745291  -0.26480228]
 [ 0.62347222 -0.0529662  -0.5338052   0.83604629 -0.09453399]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">drug_data</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/c64144c71820efdae9ded4c74865638435e542cfa81d0a4b1b9eb56a1b247d7a.png" src="../_images/c64144c71820efdae9ded4c74865638435e542cfa81d0a4b1b9eb56a1b247d7a.png" />
</div>
</div>
</section>
</section>
<section id="pca-implementation">
<h2>PCA Implementation<a class="headerlink" href="#pca-implementation" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Apply PCA transformation</p></li>
<li><p>Calculate explained variance</p></li>
</ul>
<section id="apply-pca-transformation">
<h3>Apply PCA transformation<a class="headerlink" href="#apply-pca-transformation" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the PCA instance and fit and transform the data with pca</span>
<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span>
<span class="n">pc</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">drug_data</span><span class="p">)</span>

<span class="c1">## `fit()` in PCA:</span>
<span class="c1"># Calculates the principal components (eigenvectors) and their explained variances</span>
<span class="c1"># Determines the transformation matrix based on your data</span>
<span class="c1"># Stores these components internally in the PCA object</span>
<span class="c1"># Does not actually transform your data</span>

<span class="c1">## `transform()` in PCA:</span>
<span class="c1"># Projects your data onto the principal components using the previously calculated transformation matrix</span>
<span class="c1"># Actually reduces the dimensionality of your data</span>
<span class="c1"># Example: pca.transform(X_test) projects test data onto the same components learned from training data</span>

<span class="c1">## `fit_transform()` in PCA:</span>
<span class="c1"># Combines both operations: calculates principal components and then projects your data</span>
<span class="c1"># Equivalent to calling fit() followed by transform()</span>
<span class="c1"># More efficient than calling them separately</span>
<span class="c1"># Example: pca.fit_transform(X_train) learns components from training data and immediately projects it</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Type of pc:&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">pc</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shape of pc:&quot;</span><span class="p">,</span> <span class="n">pc</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First 5 rows and columns of pc:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">pc</span><span class="p">[:</span><span class="mi">5</span><span class="p">,</span> <span class="p">:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Type of pc: &lt;class &#39;numpy.ndarray&#39;&gt;
Shape of pc: (25, 25)
First 5 rows and columns of pc:
 [[ 3.64790724  3.78552267  1.33659718 -0.20864174 -2.17346721]
 [ 0.32125071 -5.9898321   4.18994535 -0.20697045  0.17194817]
 [ 3.83231009  1.28508967 -0.47749898 -2.19393142  3.98217509]
 [-5.63359232  3.69098317 -3.47828106 -0.8034397   0.44613498]
 [ 0.17402269  1.51797501  0.16606953  2.91234111  0.42116796]]
</pre></div>
</div>
</div>
</div>
<p><strong>Note:</strong></p>
<ul class="simple">
<li><p>Original <code class="docutils literal notranslate"><span class="pre">drug_data</span></code> had 25 rows (observations), so <code class="docutils literal notranslate"><span class="pre">pc</span></code> also had 25 rows representing patients</p></li>
<li><p>We didn’t specify the number of components (<code class="docutils literal notranslate"><span class="pre">n_components</span></code>) when creating the PCA object (<code class="docutils literal notranslate"><span class="pre">pca</span> <span class="pre">=</span> <span class="pre">PCA()</span></code>), scikit-learn defaults to calculating <code class="docutils literal notranslate"><span class="pre">min(n_samples,</span> <span class="pre">n_features)</span></code> components. Original dataset had 50 features, PCA still only computes 25 components because the maximum number of meaningful principal components is limited by the number of samples (you can’t find more independent directions of variance than you have data points).</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">fit_transform</span></code> method did two things:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fit</span></code>: It analyzed drug_data to find the 25 principal component directions (axes) based on the variance and correlations between your original features.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">transform</span></code>: It then projected your original 25 samples from their original feature space (with 50 dimensions) onto this new coordinate system defined by the 25 principal components</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pc_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pc</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;PC_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
<span class="n">pc_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PC_1</th>
      <th>PC_2</th>
      <th>PC_3</th>
      <th>PC_4</th>
      <th>PC_5</th>
      <th>PC_6</th>
      <th>PC_7</th>
      <th>PC_8</th>
      <th>PC_9</th>
      <th>PC_10</th>
      <th>...</th>
      <th>PC_16</th>
      <th>PC_17</th>
      <th>PC_18</th>
      <th>PC_19</th>
      <th>PC_20</th>
      <th>PC_21</th>
      <th>PC_22</th>
      <th>PC_23</th>
      <th>PC_24</th>
      <th>PC_25</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3.647907</td>
      <td>3.785523</td>
      <td>1.336597</td>
      <td>-0.208642</td>
      <td>-2.173467</td>
      <td>-0.159574</td>
      <td>-0.201224</td>
      <td>-0.175144</td>
      <td>-0.442335</td>
      <td>0.125566</td>
      <td>...</td>
      <td>0.015509</td>
      <td>0.053778</td>
      <td>-0.106066</td>
      <td>-0.353473</td>
      <td>-0.059685</td>
      <td>-0.655202</td>
      <td>0.315228</td>
      <td>-0.239004</td>
      <td>0.257046</td>
      <td>1.959170e-16</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.321251</td>
      <td>-5.989832</td>
      <td>4.189945</td>
      <td>-0.206970</td>
      <td>0.171948</td>
      <td>0.960831</td>
      <td>-0.520194</td>
      <td>1.106246</td>
      <td>-0.674214</td>
      <td>-0.811364</td>
      <td>...</td>
      <td>-0.724327</td>
      <td>-0.503311</td>
      <td>0.348717</td>
      <td>-0.460284</td>
      <td>-0.166123</td>
      <td>0.121399</td>
      <td>0.262114</td>
      <td>0.042369</td>
      <td>-0.096848</td>
      <td>1.959170e-16</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.832310</td>
      <td>1.285090</td>
      <td>-0.477499</td>
      <td>-2.193931</td>
      <td>3.982175</td>
      <td>-0.967499</td>
      <td>-0.351455</td>
      <td>0.389307</td>
      <td>0.007497</td>
      <td>0.070364</td>
      <td>...</td>
      <td>0.080597</td>
      <td>-0.748926</td>
      <td>-0.429462</td>
      <td>-0.277130</td>
      <td>-0.028362</td>
      <td>0.054581</td>
      <td>0.009554</td>
      <td>0.045150</td>
      <td>0.040776</td>
      <td>1.959170e-16</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-5.633592</td>
      <td>3.690983</td>
      <td>-3.478281</td>
      <td>-0.803440</td>
      <td>0.446135</td>
      <td>0.610747</td>
      <td>-2.052404</td>
      <td>0.316239</td>
      <td>-1.076850</td>
      <td>-1.359736</td>
      <td>...</td>
      <td>0.029642</td>
      <td>0.142202</td>
      <td>0.806519</td>
      <td>0.175962</td>
      <td>-0.013190</td>
      <td>-0.119514</td>
      <td>-0.072060</td>
      <td>0.053852</td>
      <td>0.077116</td>
      <td>1.959170e-16</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.174023</td>
      <td>1.517975</td>
      <td>0.166070</td>
      <td>2.912341</td>
      <td>0.421168</td>
      <td>-0.887175</td>
      <td>-1.127990</td>
      <td>-1.452414</td>
      <td>-1.104615</td>
      <td>-0.970554</td>
      <td>...</td>
      <td>0.832998</td>
      <td>-0.053671</td>
      <td>-0.443638</td>
      <td>-0.031360</td>
      <td>-0.348642</td>
      <td>0.422218</td>
      <td>0.010565</td>
      <td>-0.405376</td>
      <td>-0.039028</td>
      <td>1.959170e-16</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 25 columns</p>
</div></div></div>
</div>
<section id="pca-context">
<h4>PCA context<a class="headerlink" href="#pca-context" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>PCA aims to summarize a large set of correlated variables with a smaller number of representative variables</p></li>
<li><p>The goal is to find a low-dimensional representation of the data that retains as much of the original variation as possible</p></li>
<li><p>Why focus on maximizing variance?</p>
<ul>
<li><p>By capturing most of the variation in the first few uncorrelated PCs, PCA allows you to summarize a large set of potentially correlated variables with a smaller number of representative variables</p></li>
<li><p>This process can be viewed as identifying directions in the original feature space along which the data vary the most, or finding low-dimensional linear surfaces that are closest to the observations</p></li>
<li><p>This is valuable for dimension reduction and compression, especially when dealing with many attributes that might be redundant</p></li>
</ul>
</li>
<li><p>By transforming the original correlated variables into a set of uncorrelated principal components, PCA effectively removes redundancy in the data</p>
<ul>
<li><p>PCA transforms the original correlated variables into a new set of uncorrelated variables (the principal components), ordered by how much variance they explain. This allows you to potentially use a smaller subset of these new, uncorrelated components to represent the data while retaining most of the original variability</p></li>
</ul>
</li>
<li><p><strong>The first principal component</strong> is defined as the linear combination of the original features that has the largest sample variance</p></li>
<li><p><strong>Subsequent principal components</strong> are then found such that they have the maximal variance out of all linear combinations that are uncorrelated with the preceding principal components</p>
<ul>
<li><p>For example, the second principal component must be uncorrelated with the first, the third with the first two, and so on</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drug_data_normalised</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">drug_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Correlation heatmap</span>
<span class="c1"># plt.figure(figsize=(12, 10))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">drug_data_normalised</span><span class="o">.</span><span class="n">corr</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">drug_data_normalised</span><span class="o">.</span><span class="n">corr</span><span class="p">(),</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> 
            <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Correlation Heatmap (All Drugs)&#39;</span><span class="p">)</span>

<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">pc_df</span><span class="o">.</span><span class="n">corr</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">pc_df</span><span class="o">.</span><span class="n">corr</span><span class="p">(),</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> 
            <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Correlation Heatmap (PCA Components)&#39;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/db72dccdbc8a9915ceb381195ba82aaec2f1ed948f70ba530bba1296f2b5fdcd.png" src="../_images/db72dccdbc8a9915ceb381195ba82aaec2f1ed948f70ba530bba1296f2b5fdcd.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">drug_data_normalised</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;box&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Drug Sensitivity Boxplot&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>  <span class="c1"># Rotate x-labels for axes[0]</span>
<span class="n">pc_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;box&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;PCA Components Boxplot&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/c8977976b111bc0454129f42e5ec07b651fe355df44b2898f29f24e31f22b2a7.png" src="../_images/c8977976b111bc0454129f42e5ec07b651fe355df44b2898f29f24e31f22b2a7.png" />
</div>
</div>
<p><em><strong>Note:</strong></em></p>
<ul class="simple">
<li><p>PCA successfully achieved its goal of decorrelating our dataset</p></li>
<li><p>Decorrelation:</p>
<ul>
<li><p>The variance originally shared between features (correlated features) in the original dataset has been reorganized and captured along these new, independent PC axes</p></li>
</ul>
</li>
<li><p>Correlated variables inherently contain overlapping information (shared variation)</p></li>
<li><p>When variables are correlated, it means their values tend to change together to some degree</p>
<ul>
<li><p>This implies that they are capturing some of the same underlying patterns or variance in the data</p></li>
<li><p>Dealing with a large set of correlated variables suggests there might be redundancy</p></li>
<li><p>The correlation structure can be thought of as arising from shared underlying sources or latent variables.</p></li>
</ul>
</li>
<li><p>PCA transforms these into uncorrelated components</p>
<ul>
<li><p>The process of Principal Component Analysis explicitly finds a new set of variables - principal components (PCs), which are linear combinations of the original features</p></li>
<li><p>A key property of these principal components is that they are uncorrelated with each other</p></li>
<li><p>The second principal component is defined as having maximal variance out of all linear combinations that are uncorrelated with the first principal component, and this extends to subsequent components</p></li>
</ul>
</li>
<li><p>Decorrelation ensures each PC captures a distinct aspect of variability:</p>
<ul>
<li><p>Because each subsequent principal component is constrained to be uncorrelated with the ones already found, it is forced to capture variation in a direction that is distinct from the directions represented by the earlier components</p></li>
<li><p>The first PC captures the most variance. The second PC captures the most variance that is not captured by the first PC (due to the uncorrelated constraint), and so on.</p></li>
<li><p>This ensures that each PC adds new, non-overlapping information about the data’s variability, allowing the first few components to collectively explain a “sizable amount of the variation” and provide a lower-dimensional representation that retains “as much of the information as possible”</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pc_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PC_1</th>
      <th>PC_2</th>
      <th>PC_3</th>
      <th>PC_4</th>
      <th>PC_5</th>
      <th>PC_6</th>
      <th>PC_7</th>
      <th>PC_8</th>
      <th>PC_9</th>
      <th>PC_10</th>
      <th>...</th>
      <th>PC_16</th>
      <th>PC_17</th>
      <th>PC_18</th>
      <th>PC_19</th>
      <th>PC_20</th>
      <th>PC_21</th>
      <th>PC_22</th>
      <th>PC_23</th>
      <th>PC_24</th>
      <th>PC_25</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3.647907</td>
      <td>3.785523</td>
      <td>1.336597</td>
      <td>-0.208642</td>
      <td>-2.173467</td>
      <td>-0.159574</td>
      <td>-0.201224</td>
      <td>-0.175144</td>
      <td>-0.442335</td>
      <td>0.125566</td>
      <td>...</td>
      <td>0.015509</td>
      <td>0.053778</td>
      <td>-0.106066</td>
      <td>-0.353473</td>
      <td>-0.059685</td>
      <td>-0.655202</td>
      <td>0.315228</td>
      <td>-0.239004</td>
      <td>0.257046</td>
      <td>1.959170e-16</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.321251</td>
      <td>-5.989832</td>
      <td>4.189945</td>
      <td>-0.206970</td>
      <td>0.171948</td>
      <td>0.960831</td>
      <td>-0.520194</td>
      <td>1.106246</td>
      <td>-0.674214</td>
      <td>-0.811364</td>
      <td>...</td>
      <td>-0.724327</td>
      <td>-0.503311</td>
      <td>0.348717</td>
      <td>-0.460284</td>
      <td>-0.166123</td>
      <td>0.121399</td>
      <td>0.262114</td>
      <td>0.042369</td>
      <td>-0.096848</td>
      <td>1.959170e-16</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.832310</td>
      <td>1.285090</td>
      <td>-0.477499</td>
      <td>-2.193931</td>
      <td>3.982175</td>
      <td>-0.967499</td>
      <td>-0.351455</td>
      <td>0.389307</td>
      <td>0.007497</td>
      <td>0.070364</td>
      <td>...</td>
      <td>0.080597</td>
      <td>-0.748926</td>
      <td>-0.429462</td>
      <td>-0.277130</td>
      <td>-0.028362</td>
      <td>0.054581</td>
      <td>0.009554</td>
      <td>0.045150</td>
      <td>0.040776</td>
      <td>1.959170e-16</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-5.633592</td>
      <td>3.690983</td>
      <td>-3.478281</td>
      <td>-0.803440</td>
      <td>0.446135</td>
      <td>0.610747</td>
      <td>-2.052404</td>
      <td>0.316239</td>
      <td>-1.076850</td>
      <td>-1.359736</td>
      <td>...</td>
      <td>0.029642</td>
      <td>0.142202</td>
      <td>0.806519</td>
      <td>0.175962</td>
      <td>-0.013190</td>
      <td>-0.119514</td>
      <td>-0.072060</td>
      <td>0.053852</td>
      <td>0.077116</td>
      <td>1.959170e-16</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.174023</td>
      <td>1.517975</td>
      <td>0.166070</td>
      <td>2.912341</td>
      <td>0.421168</td>
      <td>-0.887175</td>
      <td>-1.127990</td>
      <td>-1.452414</td>
      <td>-1.104615</td>
      <td>-0.970554</td>
      <td>...</td>
      <td>0.832998</td>
      <td>-0.053671</td>
      <td>-0.443638</td>
      <td>-0.031360</td>
      <td>-0.348642</td>
      <td>0.422218</td>
      <td>0.010565</td>
      <td>-0.405376</td>
      <td>-0.039028</td>
      <td>1.959170e-16</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 25 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate cumulative variance = cumulative proportion of variance explained by the principal components</span>
<span class="n">variances</span> <span class="o">=</span> <span class="n">pc_df</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">cumulative_variance</span> <span class="o">=</span> <span class="n">variances</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span> <span class="o">/</span> <span class="n">variances</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># Plot cumulative variance</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cumulative_variance</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">cumulative_variance</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Cumulative Variance Explained by Principal Components&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of Principal Components&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Cumulative Variance Explained&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/aa390baf64a7a0cac1f4fb2d5aa36871e963041e3f705469542fcbccd55b5388.png" src="../_images/aa390baf64a7a0cac1f4fb2d5aa36871e963041e3f705469542fcbccd55b5388.png" />
</div>
</div>
</section>
</section>
<section id="explained-variance">
<h3>Explained variance:<a class="headerlink" href="#explained-variance" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>PCA seeks a low-dimensional representation of a dataset that captures as much as possible of the variation in the original data</p></li>
<li><p><strong>Variance Explained by a principal component (PC):</strong></p>
<ul>
<li><p>Each PC captures a specific amount of variance (this is also known as variance explained by each PC)</p></li>
<li><p>For a specific PC, say the <code class="docutils literal notranslate"><span class="pre">m-th</span></code> one, its variance explained is essentially the variance of the scores across <code class="docutils literal notranslate"><span class="pre">m-th</span></code> PC, when the data points are projected principal components</p></li>
</ul>
</li>
<li><p><strong>Relationship between PC Variance and Total Variance:</strong></p>
<ul>
<li><p>A key property is that the <em><strong>sum of the variances of all principal components equals the total variance of the original data</strong></em></p></li>
<li><p>This means maximizing the variance of the <code class="docutils literal notranslate"><span class="pre">n</span></code> principal components is equivalent to minimizing the reconstruction error when approximating the data with those <code class="docutils literal notranslate"><span class="pre">n</span></code>  components</p></li>
</ul>
</li>
<li><p><strong>Proportion of Variance Explained - PVE (Explained Variance Ratio):</strong></p>
<ul>
<li><p>The PVE of the <code class="docutils literal notranslate"><span class="pre">mth</span></code> principal component is calculated as the variance of the <code class="docutils literal notranslate"><span class="pre">mth</span></code> principal component divided by the total variance in the original data</p></li>
<li><p>The PVEs for all principal components (up to min(n-1, p)) sum to one</p></li>
</ul>
</li>
<li><p><strong>Cumulative PVE:</strong></p>
<ul>
<li><p>The cumulative PVE of the principal components is simply the sum of the PVEs for those components</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Access the explained variance directly</span>
<span class="n">explained_variance</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Explained variance by component:&quot;</span><span class="p">,</span> <span class="n">explained_variance</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Explained variance by component: [2.06118885e+01 9.46481592e+00 5.66619038e+00 4.25914905e+00
 2.86483250e+00 1.91158440e+00 1.59439385e+00 1.22821102e+00
 9.13563089e-01 8.09987389e-01 5.90796907e-01 4.07254006e-01
 3.73077915e-01 2.98129789e-01 2.48097781e-01 2.31592814e-01
 1.58434105e-01 1.29071221e-01 8.11724160e-02 7.48451289e-02
 6.29952247e-02 5.23843184e-02 3.73057774e-02 1.35597766e-02
 3.99827721e-32]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">explained_variance_ratio</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Explained variance ratio by component:&quot;</span><span class="p">,</span> <span class="n">explained_variance_ratio</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Explained variance ratio by component: [3.95748260e-01 1.81724466e-01 1.08790855e-01 8.17756618e-02
 5.50047841e-02 3.67024205e-02 3.06123619e-02 2.35816516e-02
 1.75404113e-02 1.55517579e-02 1.13433006e-02 7.81927692e-03
 7.16309597e-03 5.72409195e-03 4.76347739e-03 4.44658203e-03
 3.04193482e-03 2.47816745e-03 1.55851039e-03 1.43702647e-03
 1.20950831e-03 1.00577891e-03 7.16270926e-04 2.60347711e-04
 7.67669224e-34]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Option 3: Calculate the cumulative explained variance</span>
<span class="n">cumulative_explained_variance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">explained_variance_ratio</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cumulative explained variance:&quot;</span><span class="p">,</span> <span class="n">cumulative_explained_variance</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cumulative explained variance: [0.39574826 0.57747273 0.68626358 0.76803924 0.82304403 0.85974645
 0.89035881 0.91394046 0.93148087 0.94703263 0.95837593 0.96619521
 0.9733583  0.9790824  0.98384587 0.98829246 0.99133439 0.99381256
 0.99537107 0.99680809 0.9980176  0.99902338 0.99973965 1.
 1.        ]
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualize-the-explained-variance">
<h3>Visualize the explained variance<a class="headerlink" href="#visualize-the-explained-variance" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualize the explained variance</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">explained_variance_ratio</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">explained_variance_ratio</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Individual explained variance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cumulative_explained_variance</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">cumulative_explained_variance</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cumulative explained variance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Explained variance ratio&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Principal components&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;95</span><span class="si">% e</span><span class="s1">xplained variance threshold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;90</span><span class="si">% e</span><span class="s1">xplained variance threshold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3ad4ea091a5a9b2196091c065d01ed8de3b5292c340fecd767ddf82b5b27b201.png" src="../_images/3ad4ea091a5a9b2196091c065d01ed8de3b5292c340fecd767ddf82b5b27b201.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cumulative_explained_variance</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">cumulative_explained_variance</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Cumulative Variance Explained by Principal Components&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of Principal Components&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Cumulative Explained Variance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d060c8ff8d7786355365430d6d182f1458824c32639dce6b924530db5b6493db.png" src="../_images/d060c8ff8d7786355365430d6d182f1458824c32639dce6b924530db5b6493db.png" />
</div>
</div>
</section>
</section>
<section id="determine-optimal-number-of-components">
<h2>Determine optimal number of components<a class="headerlink" href="#determine-optimal-number-of-components" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Variance Threshold</p></li>
<li><p>Scree Plot (Elbow Method)</p></li>
</ul>
<section id="variance-threshold">
<h3>Variance Threshold<a class="headerlink" href="#variance-threshold" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Find number of components that explain at least 95% (or 99%) of variance</p></li>
<li><p>Selects components that collectively explain a predefined percentage (e.g., 95%) of total variance</p></li>
<li><p>Ensures you keep enough information while reducing dimensions</p></li>
<li><p>Provides a clear cutoff criterion that doesn’t require subjective judgment (Automated selection)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_components_95</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">cumulative_explained_variance</span> <span class="o">&gt;=</span> <span class="mf">0.95</span><span class="p">)</span>
<span class="c1"># np.argmax(): This function returns the index of the first occurrence of the maximum value in the array.</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of components for 95% variance: </span><span class="si">{</span><span class="n">n_components_95</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># +1 because index starts at 0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of components for 95% variance: 11
</pre></div>
</div>
</div>
</div>
</section>
<section id="scree-plot">
<h3>Scree Plot<a class="headerlink" href="#scree-plot" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Helps identify the point where additional components yield diminishing returns (Visual identification)</p>
<ul>
<li><p>Balances model complexity against information retention</p></li>
</ul>
</li>
<li><p>The “elbow” often marks where principal components transition from capturing signal to capturing noise (Noise reduction)</p></li>
</ul>
<p><strong>Logic Behind Using a Scree Plot:</strong></p>
<ol class="arabic simple">
<li><p>Understanding Eigenvalues</p></li>
</ol>
<ul class="simple">
<li><p>Eigenvalues are the foundation of scree plots. In PCA, eigenvalues represent the amount of variance captured by each  principal component</p></li>
<li><p>Eigenvalue associated with a specific eigenvector is equal to the variance of the corresponding principal component</p></li>
<li><p>Specifically:</p>
<ul>
<li><p>Each eigenvalue corresponds to one principal component</p></li>
<li><p>The magnitude of an eigenvalue indicates how much variance that component explains</p></li>
<li><p>Eigenvalues are measured in the same units as the original data’s variance (When PCA is performed on the standardized data, eigenvalues are unitless because standardization removes units)</p></li>
<li><p>The sum of all eigenvalues equals the total variance in the dataset</p></li>
</ul>
</li>
</ul>
<ol class="arabic simple" start="3">
<li><p>The Scree Plot Displays Eigenvalues</p></li>
</ol>
<ul class="simple">
<li><p>A scree plot displays the <strong>eigenvalues</strong> (not directly the proportion of variance explained) on the Y-axis for each principal component on the X-axis</p></li>
<li><p>The eigenvalues are plotted in descending order, creating the characteristic “scree” or slope appearance.</p></li>
</ul>
<ol class="arabic simple" start="4">
<li><p>Relationship to Proportion of Variance Explained (PVE):</p></li>
</ol>
<ul class="simple">
<li><p><strong>PVE</strong> for the m-th principal component = (Eigenvalue of m-th component) / (Sum of all eigenvalues)</p></li>
<li><p>Together, all principal components explain 100% of the variance (sum of all PVEs = 1)</p></li>
</ul>
<ol class="arabic simple" start="5">
<li><p>Identifying the “Elbow”</p></li>
</ol>
<ul class="simple">
<li><p>The visual logic involves examining the scree plot and looking for a point where the eigenvalues drop off noticeably</p></li>
<li><p>This sharp drop-off is often referred to as an “elbow” in the plot</p></li>
<li><p>Since eigenvalues directly represent variance amounts, a steep decline indicates that subsequent components capture significantly less variance.</p></li>
</ul>
<ol class="arabic simple" start="6">
<li><p>Interpreting the Elbow</p>
<ul class="simple">
<li><p>The idea is that the components before the elbow have <strong>large eigenvalues</strong> and therefore capture a “sizable amount of the variation,” representing the key dimensions along which the data vary the most</p></li>
<li><p>Components after the elbow have <strong>small eigenvalues</strong> and explain significantly less additional variance, making them less “interesting” or necessary for understanding the main patterns in the data.</p></li>
</ul>
</li>
<li><p>By choosing the number of components up to the elbow, you aim to retain the minimum number of components required to explain a substantial portion of the total variance while achieving dimensionality reduction.</p></li>
</ol>
<p><em>Important Considerations:</em></p>
<ul class="simple">
<li><p>This method of choosing the number of components by inspecting the scree plot is <strong>“ad hoc” and “inherently subjective”</strong></p></li>
<li><p>There isn’t a single, universally accepted objective rule based solely on the scree plot</p></li>
<li><p>The decision often depends on the specific application and the dataset</p></li>
<li><p>In practice, analysts might look at the first few components for interesting patterns and continue examining subsequent ones until no further insights are gained</p></li>
<li><p>Alternative methods include using cumulative proportion of variance explained (e.g., retaining components that explain 80-90% of total variance) or cross-validation approaches</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">explained_variance</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">explained_variance</span><span class="p">,</span> <span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Scree Plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Principal Component&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Eigenvalue (Variance)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/18e7566391389df74808f023cc93946de2f0c92fff9b6036a34f5b7a6497f16f.png" src="../_images/18e7566391389df74808f023cc93946de2f0c92fff9b6036a34f5b7a6497f16f.png" />
</div>
</div>
</section>
</section>
<section id="automated-selection-with-pca">
<h2>Automated Selection with PCA<a class="headerlink" href="#automated-selection-with-pca" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Instead of manually determining the number of components, you can initialize PCA with a variance threshold:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Automatically select components to explain 90% of variance</span>
<span class="n">optimal_pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mf">0.90</span><span class="p">)</span>  <span class="c1"># Keep enough components to explain 90% of variance</span>
<span class="n">pc_auto</span> <span class="o">=</span> <span class="n">optimal_pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">drug_data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of components selected: </span><span class="si">{</span><span class="n">optimal_pca</span><span class="o">.</span><span class="n">n_components_</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">optimal_pca_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">pc_auto</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;PC</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pc_auto</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
<span class="p">)</span>
<span class="n">optimal_pca_df</span><span class="p">[</span><span class="s1">&#39;Patient ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Patient ID&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Optimal PCA DataFrame: </span><span class="se">\n</span><span class="si">{</span><span class="n">optimal_pca_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of components selected: 8
Optimal PCA DataFrame: 
        PC1       PC2       PC3       PC4       PC5       PC6       PC7  \
0  3.647907  3.785523  1.336597 -0.208642 -2.173467 -0.159574 -0.201224   
1  0.321251 -5.989832  4.189945 -0.206970  0.171948  0.960831 -0.520194   
2  3.832310  1.285090 -0.477499 -2.193931  3.982175 -0.967499 -0.351455   
3 -5.633592  3.690983 -3.478281 -0.803440  0.446135  0.610747 -2.052404   
4  0.174023  1.517975  0.166070  2.912341  0.421168 -0.887175 -1.127990   

        PC8    Patient ID  
0 -0.175144  TCGA-D8-A1JU  
1  1.106246  TCGA-AC-A3QQ  
2  0.389307  TCGA-C8-A12Q  
3  0.316239  TCGA-AR-A1AY  
4 -1.452414  TCGA-A8-A0A2  
</pre></div>
</div>
</div>
</div>
</section>
<section id="feature-loadings">
<h2>Feature Loadings<a class="headerlink" href="#feature-loadings" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Feature Loadings are</p>
<ul>
<li><p>the weights that transform original, potentially correlated variables into a new set of principal components</p></li>
<li><p>i.e., contribution of each original feature to each principal component</p></li>
</ul>
</li>
<li><p>Shows which original features most strongly influence each principal component - <strong>Feature influence</strong></p></li>
<li><p>Helps interpret what each principal component represents - <strong>Component interpretation</strong></p></li>
<li><p>Identifies which original features are most important for your dataset’s structure - <strong>Feature selection</strong></p></li>
<li><p>Reveals relationships between features in your high-dimensional space - <strong>Dimensionality insights</strong></p></li>
</ul>
<p><strong>Loading and correlation:</strong></p>
<ul class="simple">
<li><p>Loadings are not correlations themselves - they are the coefficients (weights) in the linear combination that defines the principal component</p></li>
<li><p>In PCA (with standardized data), loadings are proportional to correlations between original variables and PC scores</p></li>
</ul>
<p><strong>Positive Loading (e.g., +0.7):</strong></p>
<ul class="simple">
<li><p>This indicates a positive correlation</p></li>
<li><p>When the score of the principal component increases, the value of the original feature also tends to increase. Conversely, when the PC score decreases, the feature’s value tends to decrease.</p></li>
</ul>
<p><strong>Negative Loading (e.g., -0.6):</strong></p>
<ul class="simple">
<li><p>This indicates a negative correlation</p></li>
<li><p>When the score of the principal component increases, the value of the original feature tends to decrease. Conversely, when the PC score decreases, the feature’s value tends to increase</p></li>
</ul>
<p>High absolute values (positive or negative) indicate strong influence on that component. A loading of 0 means no influence</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">loadings</span> <span class="o">=</span> <span class="n">optimal_pca</span><span class="o">.</span><span class="n">components_</span>

<span class="c1"># Get feature names (assuming you have them in a list or as column names)</span>
<span class="n">feature_names</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">columns</span>  <span class="c1"># Or your list of feature names</span>

<span class="c1"># Create a DataFrame with the loadings</span>
<span class="n">loadings_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">loadings</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">feature_names</span><span class="p">,</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;PC_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">loadings</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
<span class="p">)</span>

<span class="n">loadings_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 8 entries, PC_1 to PC_8
Data columns (total 50 columns):
 #   Column                          Non-Null Count  Dtype  
---  ------                          --------------  -----  
 0   bendamustine                    8 non-null      float64
 1   ML320                           8 non-null      float64
 2   BRD-K14844214                   8 non-null      float64
 3   leptomycin B                    8 non-null      float64
 4   Compound 23 citrate             8 non-null      float64
 5   BRD4132                         8 non-null      float64
 6   dabrafenib                      8 non-null      float64
 7   necrosulfonamide                8 non-null      float64
 8   PF-543                          8 non-null      float64
 9   KX2-391                         8 non-null      float64
 10  ELCPK                           8 non-null      float64
 11  carboplatin                     8 non-null      float64
 12  SB-525334                       8 non-null      float64
 13  CIL41                           8 non-null      float64
 14  belinostat                      8 non-null      float64
 15  Compound 7d-cis                 8 non-null      float64
 16  lapatinib                       8 non-null      float64
 17  tacrolimus                      8 non-null      float64
 18  pifithrin-mu                    8 non-null      float64
 19  RG-108                          8 non-null      float64
 20  BRD-K97651142                   8 non-null      float64
 21  NVP-BEZ235                      8 non-null      float64
 22  BRD-K01737880                   8 non-null      float64
 23  pluripotin                      8 non-null      float64
 24  GW-405833                       8 non-null      float64
 25  masitinib                       8 non-null      float64
 26  YM-155                          8 non-null      float64
 27  MLN2238                         8 non-null      float64
 28  birinapant                      8 non-null      float64
 29  RAF265                          8 non-null      float64
 30  BRD-K27188169                   8 non-null      float64
 31  PIK-93                          8 non-null      float64
 32  N9-isopropylolomoucine          8 non-null      float64
 33  myricetin                       8 non-null      float64
 34  epigallocatechin-3-monogallate  8 non-null      float64
 35  ceranib-2                       8 non-null      float64
 36  BRD-K66532283                   8 non-null      float64
 37  elocalcitol                     8 non-null      float64
 38  RO4929097                       8 non-null      float64
 39  BRD-K02251932                   8 non-null      float64
 40  Compound 1541A                  8 non-null      float64
 41  pevonedistat                    8 non-null      float64
 42  ISOX                            8 non-null      float64
 43  tosedostat                      8 non-null      float64
 44  AT13387                         8 non-null      float64
 45  BRD-A02303741                   8 non-null      float64
 46  BRD-K99006945                   8 non-null      float64
 47  GSK525762A                      8 non-null      float64
 48  necrostatin-7                   8 non-null      float64
 49  nakiterpiosin                   8 non-null      float64
dtypes: float64(50)
memory usage: 3.2+ KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Contribution of each original feature to each principal component&quot;</span><span class="p">)</span>
<span class="n">loadings_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Contribution of each original feature to each principal component
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bendamustine</th>
      <th>ML320</th>
      <th>BRD-K14844214</th>
      <th>leptomycin B</th>
      <th>Compound 23 citrate</th>
      <th>BRD4132</th>
      <th>dabrafenib</th>
      <th>necrosulfonamide</th>
      <th>PF-543</th>
      <th>KX2-391</th>
      <th>...</th>
      <th>Compound 1541A</th>
      <th>pevonedistat</th>
      <th>ISOX</th>
      <th>tosedostat</th>
      <th>AT13387</th>
      <th>BRD-A02303741</th>
      <th>BRD-K99006945</th>
      <th>GSK525762A</th>
      <th>necrostatin-7</th>
      <th>nakiterpiosin</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>PC_1</th>
      <td>0.188893</td>
      <td>0.158907</td>
      <td>-0.014409</td>
      <td>0.184616</td>
      <td>0.188557</td>
      <td>0.148854</td>
      <td>0.169982</td>
      <td>0.195003</td>
      <td>0.114682</td>
      <td>0.186589</td>
      <td>...</td>
      <td>0.013166</td>
      <td>0.186654</td>
      <td>0.211779</td>
      <td>0.153139</td>
      <td>0.186287</td>
      <td>0.091061</td>
      <td>-0.092112</td>
      <td>0.125780</td>
      <td>0.127629</td>
      <td>0.184714</td>
    </tr>
    <tr>
      <th>PC_2</th>
      <td>0.130845</td>
      <td>-0.140145</td>
      <td>-0.233375</td>
      <td>0.073321</td>
      <td>-0.021347</td>
      <td>0.107959</td>
      <td>-0.080697</td>
      <td>-0.013266</td>
      <td>-0.024182</td>
      <td>0.121842</td>
      <td>...</td>
      <td>-0.272325</td>
      <td>0.094608</td>
      <td>0.014560</td>
      <td>0.064277</td>
      <td>0.026162</td>
      <td>-0.255982</td>
      <td>-0.258407</td>
      <td>-0.169401</td>
      <td>0.188433</td>
      <td>0.083508</td>
    </tr>
    <tr>
      <th>PC_3</th>
      <td>-0.021312</td>
      <td>-0.084223</td>
      <td>0.186021</td>
      <td>0.116362</td>
      <td>-0.187231</td>
      <td>0.127776</td>
      <td>-0.129210</td>
      <td>-0.165453</td>
      <td>0.120737</td>
      <td>0.124947</td>
      <td>...</td>
      <td>0.026282</td>
      <td>-0.007923</td>
      <td>-0.035613</td>
      <td>0.082174</td>
      <td>-0.057860</td>
      <td>-0.049318</td>
      <td>0.141969</td>
      <td>-0.145518</td>
      <td>-0.050762</td>
      <td>0.125907</td>
    </tr>
    <tr>
      <th>PC_4</th>
      <td>0.002208</td>
      <td>0.054969</td>
      <td>-0.168718</td>
      <td>0.204135</td>
      <td>0.007250</td>
      <td>-0.127992</td>
      <td>0.012934</td>
      <td>-0.043828</td>
      <td>-0.228499</td>
      <td>0.082702</td>
      <td>...</td>
      <td>-0.175538</td>
      <td>0.146641</td>
      <td>-0.057821</td>
      <td>0.019380</td>
      <td>0.129659</td>
      <td>-0.015643</td>
      <td>0.014241</td>
      <td>0.011453</td>
      <td>-0.116959</td>
      <td>0.151041</td>
    </tr>
    <tr>
      <th>PC_5</th>
      <td>0.032004</td>
      <td>0.169326</td>
      <td>-0.154553</td>
      <td>-0.061343</td>
      <td>-0.063709</td>
      <td>0.255198</td>
      <td>0.039662</td>
      <td>-0.012972</td>
      <td>-0.180148</td>
      <td>-0.060818</td>
      <td>...</td>
      <td>-0.012056</td>
      <td>0.095784</td>
      <td>-0.037420</td>
      <td>-0.213437</td>
      <td>-0.050259</td>
      <td>0.151289</td>
      <td>0.119979</td>
      <td>-0.133028</td>
      <td>-0.047117</td>
      <td>-0.040750</td>
    </tr>
    <tr>
      <th>PC_6</th>
      <td>0.026600</td>
      <td>-0.001502</td>
      <td>-0.203015</td>
      <td>0.044929</td>
      <td>0.140286</td>
      <td>0.042471</td>
      <td>0.153289</td>
      <td>-0.052095</td>
      <td>0.269030</td>
      <td>-0.099810</td>
      <td>...</td>
      <td>-0.158710</td>
      <td>-0.120513</td>
      <td>-0.109148</td>
      <td>0.034131</td>
      <td>0.272596</td>
      <td>0.106136</td>
      <td>-0.022863</td>
      <td>-0.083687</td>
      <td>0.295653</td>
      <td>-0.157441</td>
    </tr>
    <tr>
      <th>PC_7</th>
      <td>0.110011</td>
      <td>0.061453</td>
      <td>-0.006347</td>
      <td>0.049683</td>
      <td>-0.096940</td>
      <td>0.049480</td>
      <td>-0.080599</td>
      <td>0.157775</td>
      <td>-0.281277</td>
      <td>-0.054539</td>
      <td>...</td>
      <td>0.088570</td>
      <td>0.008416</td>
      <td>-0.082869</td>
      <td>0.363718</td>
      <td>-0.125535</td>
      <td>0.122516</td>
      <td>-0.145911</td>
      <td>-0.100268</td>
      <td>0.119357</td>
      <td>0.078340</td>
    </tr>
    <tr>
      <th>PC_8</th>
      <td>-0.007307</td>
      <td>-0.195364</td>
      <td>-0.010461</td>
      <td>0.000593</td>
      <td>0.019415</td>
      <td>0.083812</td>
      <td>0.053971</td>
      <td>-0.126673</td>
      <td>0.113933</td>
      <td>-0.000942</td>
      <td>...</td>
      <td>-0.087146</td>
      <td>0.140472</td>
      <td>-0.021129</td>
      <td>-0.089389</td>
      <td>-0.021654</td>
      <td>0.044740</td>
      <td>-0.014215</td>
      <td>0.338453</td>
      <td>-0.170848</td>
      <td>0.043675</td>
    </tr>
  </tbody>
</table>
<p>8 rows × 50 columns</p>
</div></div></div>
</div>
<section id="visualization-feature-loadings">
<h3>Visualization - Feature Loadings<a class="headerlink" href="#visualization-feature-loadings" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a heatmap</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">heatmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
    <span class="n">loadings_df</span><span class="p">,</span> 
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span>
    <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span>
    <span class="n">linewidths</span><span class="o">=</span><span class="mf">.5</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PCA Feature Loadings&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/555d2bb8e7cda6a8d45b5794c47d8c310f955c830b5c23d98758d4ca28a8bc55.png" src="../_images/555d2bb8e7cda6a8d45b5794c47d8c310f955c830b5c23d98758d4ca28a8bc55.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select top n contributing features for each component</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_top_features</span><span class="p">(</span><span class="n">loadings_df</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">top_features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">pc</span> <span class="ow">in</span> <span class="n">loadings_df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="n">pc_loadings</span> <span class="o">=</span> <span class="n">loadings_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pc</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">top_features</span><span class="p">[</span><span class="n">pc</span><span class="p">]</span> <span class="o">=</span> <span class="n">pc_loadings</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span>
        
    <span class="k">return</span> <span class="n">top_features</span>

<span class="n">top_features</span> <span class="o">=</span> <span class="n">get_top_features</span><span class="p">(</span><span class="n">loadings_df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Top contributing features for each principal component:&quot;</span><span class="p">)</span>
<span class="n">top_features</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top contributing features for each principal component:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PC_1</th>
      <th>PC_2</th>
      <th>PC_3</th>
      <th>PC_4</th>
      <th>PC_5</th>
      <th>PC_6</th>
      <th>PC_7</th>
      <th>PC_8</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ISOX</td>
      <td>lapatinib</td>
      <td>NVP-BEZ235</td>
      <td>pluripotin</td>
      <td>CIL41</td>
      <td>RO4929097</td>
      <td>birinapant</td>
      <td>SB-525334</td>
    </tr>
    <tr>
      <th>1</th>
      <td>necrosulfonamide</td>
      <td>Compound 1541A</td>
      <td>RO4929097</td>
      <td>N9-isopropylolomoucine</td>
      <td>birinapant</td>
      <td>necrostatin-7</td>
      <td>tosedostat</td>
      <td>GSK525762A</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ceranib-2</td>
      <td>BRD-K99006945</td>
      <td>BRD-K02251932</td>
      <td>SB-525334</td>
      <td>NVP-BEZ235</td>
      <td>AT13387</td>
      <td>BRD-K66532283</td>
      <td>RO4929097</td>
    </tr>
    <tr>
      <th>3</th>
      <td>MLN2238</td>
      <td>BRD-A02303741</td>
      <td>elocalcitol</td>
      <td>PF-543</td>
      <td>BRD4132</td>
      <td>PF-543</td>
      <td>PF-543</td>
      <td>myricetin</td>
    </tr>
    <tr>
      <th>4</th>
      <td>BRD-K66532283</td>
      <td>RAF265</td>
      <td>BRD-K27188169</td>
      <td>birinapant</td>
      <td>RG-108</td>
      <td>tacrolimus</td>
      <td>myricetin</td>
      <td>BRD-K97651142</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Compound 7d-cis</td>
      <td>BRD-K14844214</td>
      <td>YM-155</td>
      <td>masitinib</td>
      <td>lapatinib</td>
      <td>CIL41</td>
      <td>GW-405833</td>
      <td>ML320</td>
    </tr>
    <tr>
      <th>6</th>
      <td>bendamustine</td>
      <td>PIK-93</td>
      <td>BRD-K01737880</td>
      <td>leptomycin B</td>
      <td>tosedostat</td>
      <td>carboplatin</td>
      <td>BRD-K97651142</td>
      <td>epigallocatechin-3-monogallate</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Compound 23 citrate</td>
      <td>carboplatin</td>
      <td>ELCPK</td>
      <td>BRD-K02251932</td>
      <td>RAF265</td>
      <td>BRD-K27188169</td>
      <td>RO4929097</td>
      <td>necrostatin-7</td>
    </tr>
    <tr>
      <th>8</th>
      <td>GW-405833</td>
      <td>BRD-K97651142</td>
      <td>masitinib</td>
      <td>PIK-93</td>
      <td>belinostat</td>
      <td>BRD-K14844214</td>
      <td>RG-108</td>
      <td>N9-isopropylolomoucine</td>
    </tr>
    <tr>
      <th>9</th>
      <td>pevonedistat</td>
      <td>myricetin</td>
      <td>CIL41</td>
      <td>myricetin</td>
      <td>PIK-93</td>
      <td>elocalcitol</td>
      <td>necrosulfonamide</td>
      <td>BRD-K01737880</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="k-means-cluster-analysis">
<h2>K-means Cluster analysis<a class="headerlink" href="#k-means-cluster-analysis" title="Link to this heading"></a></h2>
<p><strong>Logic - Minimizing Variation:</strong></p>
<ul class="simple">
<li><p>The core logic of K-means is to find a partition that minimizes the within-cluster variation.</p></li>
<li><p>The algorithm aims to partition the observations into K clusters such that the total within-cluster variation, summed over all K clusters, is minimized.</p></li>
<li><p>The objective being minimized is the sum of squared distances between each point and the centroid of its assigned cluster</p></li>
</ul>
<section id="inertia-within-cluster-sum-of-squares">
<h3>Inertia (within-cluster sum-of-squares)<a class="headerlink" href="#inertia-within-cluster-sum-of-squares" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Inertia is a mathematical measure that quantifies how tightly grouped the data points are within their assigned clusters</p></li>
<li><p>Definition: Inertia is the total within-cluster sum of squares. It is a measure of how internally coherent the clusters are</p></li>
<li><p>K-means clustering uses an iterative optimization strategy to minimize inertia</p></li>
<li><p>Inertia always decreases or stays the same, never increases</p></li>
<li><p>The rate of decrease typically follows a curve that looks like this:</p>
<ul>
<li><p>Rapid decrease initially (adding the first few clusters)</p></li>
<li><p>Gradually diminishing returns as K continues to increase</p></li>
<li><p>Eventually, minimal improvements with additional clusters</p></li>
</ul>
</li>
</ul>
<p><strong>Why This Happens?</strong></p>
<ul class="simple">
<li><p>With more clusters, each data point can be assigned to a centroid that’s closer to it</p></li>
<li><p>When K=1: Maximum inertia (all points compared to global mean)</p></li>
<li><p>When K=n (number of data points): Zero inertia (each point is its own cluster)</p></li>
<li><p>The first few clusters capture the major structure in the data, while additional clusters only capture finer details (<em>Diminishing returns</em>)</p></li>
</ul>
<section id="the-elbow-method">
<h4>The Elbow Method<a class="headerlink" href="#the-elbow-method" title="Link to this heading"></a></h4>
<p>This behavior forms the basis of the popular “elbow method” for determining the optimal number of clusters:</p>
<ol class="arabic simple">
<li><p>Plot inertia against K (for K=1,2,3…)</p></li>
<li><p>Look for the “elbow point” where the curve bends sharply</p></li>
<li><p>This point represents where adding more clusters stops providing significant reduction in inertia</p></li>
</ol>
<p><strong>Important Considerations:</strong></p>
<ol class="arabic simple">
<li><p>Inertia will always decrease as K increases, even if you’re adding meaningless clusters</p></li>
<li><p>This is why we look for the elbow point rather than simply minimizing inertia</p></li>
</ol>
</section>
</section>
<section id="silhouette-score">
<h3>Silhouette Score<a class="headerlink" href="#silhouette-score" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Evaluating clustering quality using inertia only raises some limitations</p>
<ul>
<li><p>It measures how similar each point is to its own cluster (cohesion)</p></li>
<li><p>but do not evaluate how different it is from other clusters (separation)</p></li>
</ul>
</li>
<li><p>Silhouette Score is a measure of how similar an object is to its own cluster compared to other clusters</p></li>
<li><p>Measures how similar a data point is to its own cluster (cohesion) compared to other clusters (separation)</p></li>
<li><p>While Inertia is the objective function that the K-means algorithm directly tries to minimize during its iterative process, the Silhouette Score is a measure used to evaluate the quality of the clustering result after the algorithm has finished. It is not part of the K-means algorithm’s iterative assignment and update steps.</p></li>
</ul>
<p><strong>Is each data point placed in the right cluster?</strong></p>
<ul class="simple">
<li><p>How close a point is to other points in its assigned cluster (inertia)</p></li>
<li><p>How close that same point is to points in the nearest neighboring cluster (Silhouette Score)</p></li>
</ul>
</section>
<section id="interpretation-of-silhouette-score">
<h3>Interpretation of Silhouette Score<a class="headerlink" href="#interpretation-of-silhouette-score" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>The silhouette score ranges from -1 to 1:</p>
<ul>
<li><p>Close to +1: The point is well matched to its own cluster and far from neighboring clusters</p></li>
<li><p>Close to 0: The point lies near the boundary between two clusters</p></li>
<li><p>Close to -1: The point might be assigned to the wrong cluster</p></li>
</ul>
</li>
<li><p>The overall silhouette score of a cluster is simply the average of all individual silhouette scores.</p></li>
</ul>
<section id="finding-optimal-k-using-silhouette">
<h4>Finding Optimal K Using Silhouette<a class="headerlink" href="#finding-optimal-k-using-silhouette" title="Link to this heading"></a></h4>
<p>Unlike inertia which always decreases as K increases, the silhouette score typically:</p>
<ul class="simple">
<li><p>Increases as K approaches the natural number of clusters</p></li>
<li><p>Reaches a maximum at or near the optimal K</p></li>
<li><p>Decreases as K becomes too large</p></li>
<li><p>This makes it particularly useful for determining the optimal number of clusters - you simply choose the K value that maximizes the average silhouette score.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Determine optimal number of clusters using the Elbow method</span>

<span class="n">inertia</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">silhouette_scores</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">k_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>  <span class="c1"># Testing from 2 to 10 clusters</span>

<span class="c1"># Exclude the Patient ID column for clustering</span>
<span class="n">pca_data</span> <span class="o">=</span> <span class="n">optimal_pca_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Patient ID&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">k_range</span><span class="p">:</span>
    <span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">kmeans</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pca_data</span><span class="p">)</span>
    <span class="n">inertia</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kmeans</span><span class="o">.</span><span class="n">inertia_</span><span class="p">)</span>
    
    <span class="c1"># Calculate silhouette score (only valid for k &gt;= 2)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">labels_</span>
    <span class="n">silhouette_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">silhouette_score</span><span class="p">(</span><span class="n">pca_data</span><span class="p">,</span> <span class="n">labels</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Silhouette score for </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> clusters: </span><span class="si">{</span><span class="n">silhouette_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Silhouette score for 2 clusters: 0.315860568817066
Silhouette score for 3 clusters: 0.23399486593926483
Silhouette score for 4 clusters: 0.1923227376052971
Silhouette score for 5 clusters: 0.21280378841022102
Silhouette score for 6 clusters: 0.2215781206218201
Silhouette score for 7 clusters: 0.18825389524527888
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Silhouette score for 8 clusters: 0.16503544411475235
Silhouette score for 9 clusters: 0.13979820154212966
Silhouette score for 10 clusters: 0.13772690406314397
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the Elbow curve</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_range</span><span class="p">,</span> <span class="n">inertia</span><span class="p">,</span> <span class="s1">&#39;o-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of clusters (k)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Inertia&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Elbow Method for Optimal k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Plot silhouette scores</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_range</span><span class="p">,</span> <span class="n">silhouette_scores</span><span class="p">,</span> <span class="s1">&#39;o-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of clusters (k)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Silhouette Score&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Silhouette Scores for Different k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2d3fa3dc2d2d4eade73a96b9f6a7b0c94eb5fc17c7af6d709ad9d4b51afa5292.png" src="../_images/2d3fa3dc2d2d4eade73a96b9f6a7b0c94eb5fc17c7af6d709ad9d4b51afa5292.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 2. Apply K-means with the optimal k</span>
<span class="n">optimal_k</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># optimal k from the plots</span>
<span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">optimal_k</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Fit K-means with the optimal number of clusters</span>
<span class="n">clusters</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pca_data</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of clusters: </span><span class="si">{</span><span class="n">optimal_k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cluster centers:</span><span class="se">\n</span><span class="si">{</span><span class="n">kmeans</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cluster labels for each patient sample: </span><span class="si">{</span><span class="n">clusters</span><span class="o">.</span><span class="n">labels_</span><span class="si">}</span><span class="s2">, shape: </span><span class="si">{</span><span class="n">clusters</span><span class="o">.</span><span class="n">labels_</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of clusters: 3
Cluster centers:
[[ 2.42255496  1.31481132  0.22658619  0.31864774  0.11053081 -0.05490954
  -0.12686288 -0.10959923]
 [-1.34671408 -3.70301852 -0.57098639 -0.42079775 -0.54593247 -0.09185375
   0.23802588  0.04913763]
 [-8.97044194  2.06631993  0.19937064 -0.61137725  0.72118837  0.48887309
   0.0789207   0.43334165]]
Cluster labels for each patient sample: [0 1 0 2 0 1 0 0 0 0 0 1 0 0 0 2 0 1 0 1 0 2 1 1 0], shape: (25,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3. Add cluster labels to the dataframe</span>
<span class="n">optimal_pca_df</span><span class="p">[</span><span class="s1">&#39;Cluster&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clusters</span><span class="o">.</span><span class="n">labels_</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First 5 rows of PCA DataFrame with cluster labels:&quot;</span><span class="p">)</span>
<span class="n">optimal_pca_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>First 5 rows of PCA DataFrame with cluster labels:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PC1</th>
      <th>PC2</th>
      <th>PC3</th>
      <th>PC4</th>
      <th>PC5</th>
      <th>PC6</th>
      <th>PC7</th>
      <th>PC8</th>
      <th>Patient ID</th>
      <th>Cluster</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3.647907</td>
      <td>3.785523</td>
      <td>1.336597</td>
      <td>-0.208642</td>
      <td>-2.173467</td>
      <td>-0.159574</td>
      <td>-0.201224</td>
      <td>-0.175144</td>
      <td>TCGA-D8-A1JU</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.321251</td>
      <td>-5.989832</td>
      <td>4.189945</td>
      <td>-0.206970</td>
      <td>0.171948</td>
      <td>0.960831</td>
      <td>-0.520194</td>
      <td>1.106246</td>
      <td>TCGA-AC-A3QQ</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.832310</td>
      <td>1.285090</td>
      <td>-0.477499</td>
      <td>-2.193931</td>
      <td>3.982175</td>
      <td>-0.967499</td>
      <td>-0.351455</td>
      <td>0.389307</td>
      <td>TCGA-C8-A12Q</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-5.633592</td>
      <td>3.690983</td>
      <td>-3.478281</td>
      <td>-0.803440</td>
      <td>0.446135</td>
      <td>0.610747</td>
      <td>-2.052404</td>
      <td>0.316239</td>
      <td>TCGA-AR-A1AY</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.174023</td>
      <td>1.517975</td>
      <td>0.166070</td>
      <td>2.912341</td>
      <td>0.421168</td>
      <td>-0.887175</td>
      <td>-1.127990</td>
      <td>-1.452414</td>
      <td>TCGA-A8-A0A2</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Basic cluster analysis</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cluster distribution:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">optimal_pca_df</span><span class="p">[</span><span class="s1">&#39;Cluster&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cluster distribution:
Cluster
0    15
1     7
2     3
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">optimal_pca_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;Cluster&quot;</span><span class="p">,</span> <span class="s2">&quot;Patient ID&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Counts&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Counts&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Cluster</th>
      <th>Patient ID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>TCGA-A8-A07G</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>TCGA-A8-A08Z</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>TCGA-A8-A0A2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>TCGA-AN-A0XW</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>TCGA-BH-A0AU</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0</td>
      <td>TCGA-BH-A0DV</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0</td>
      <td>TCGA-BH-A18K</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0</td>
      <td>TCGA-BH-A1F8</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0</td>
      <td>TCGA-C8-A12Q</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0</td>
      <td>TCGA-D8-A1J8</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0</td>
      <td>TCGA-D8-A1JN</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0</td>
      <td>TCGA-D8-A1JU</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0</td>
      <td>TCGA-EW-A1P1</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0</td>
      <td>TCGA-EW-A3E8</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0</td>
      <td>TCGA-LD-A7W6</td>
    </tr>
    <tr>
      <th>15</th>
      <td>1</td>
      <td>TCGA-A2-A0CX</td>
    </tr>
    <tr>
      <th>16</th>
      <td>1</td>
      <td>TCGA-A2-A0CY</td>
    </tr>
    <tr>
      <th>17</th>
      <td>1</td>
      <td>TCGA-AC-A3QQ</td>
    </tr>
    <tr>
      <th>18</th>
      <td>1</td>
      <td>TCGA-AO-A12F</td>
    </tr>
    <tr>
      <th>19</th>
      <td>1</td>
      <td>TCGA-AR-A1AH</td>
    </tr>
    <tr>
      <th>20</th>
      <td>1</td>
      <td>TCGA-E2-A10C</td>
    </tr>
    <tr>
      <th>21</th>
      <td>1</td>
      <td>TCGA-E2-A1LL</td>
    </tr>
    <tr>
      <th>22</th>
      <td>2</td>
      <td>TCGA-AR-A1AY</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2</td>
      <td>TCGA-EW-A3U0</td>
    </tr>
    <tr>
      <th>24</th>
      <td>2</td>
      <td>TCGA-OL-A5D7</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate mean of each feature for each cluster</span>
<span class="n">cluster_means</span> <span class="o">=</span> <span class="n">optimal_pca_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;Patient ID&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Cluster&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Cluster centers in PCA space:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cluster_means</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cluster centers in PCA space:
              PC1       PC2       PC3       PC4       PC5       PC6       PC7  \
Cluster                                                                         
0        2.422555  1.314811  0.226586  0.318648  0.110531 -0.054910 -0.126863   
1       -1.346714 -3.703019 -0.570986 -0.420798 -0.545932 -0.091854  0.238026   
2       -8.970442  2.066320  0.199371 -0.611377  0.721188  0.488873  0.078921   

              PC8  
Cluster            
0       -0.109599  
1        0.049138  
2        0.433342  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 4. Visualize clusters using first two principal components</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">optimal_k</span><span class="p">):</span>
    <span class="n">cluster_points</span> <span class="o">=</span> <span class="n">optimal_pca_df</span><span class="p">[</span><span class="n">optimal_pca_df</span><span class="p">[</span><span class="s1">&#39;Cluster&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cluster</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">cluster_points</span><span class="p">[</span><span class="s1">&#39;PC1&#39;</span><span class="p">],</span> 
        <span class="n">cluster_points</span><span class="p">[</span><span class="s1">&#39;PC2&#39;</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Cluster </span><span class="si">{</span><span class="n">cluster</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
        <span class="n">s</span><span class="o">=</span><span class="mi">80</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cluster_points</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;PC1&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;PC2&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Patient ID&#39;</span><span class="p">]),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">centers</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">cluster_centers_</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">centers</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> 
    <span class="n">centers</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> 
    <span class="n">s</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> 
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> 
    <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> 
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Centroids&#39;</span>
<span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Cluster&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">title_fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Principal Component 1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Principal Component 2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Clusters Visualized on First Two Principal Components&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2fba9c971a763b91dd2cb5559818d5107f42c3c2011f4e3052bf3fbe001a29b1.png" src="../_images/2fba9c971a763b91dd2cb5559818d5107f42c3c2011f4e3052bf3fbe001a29b1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">optimal_pca_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PC1</th>
      <th>PC2</th>
      <th>PC3</th>
      <th>PC4</th>
      <th>PC5</th>
      <th>PC6</th>
      <th>PC7</th>
      <th>PC8</th>
      <th>Patient ID</th>
      <th>Cluster</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3.647907</td>
      <td>3.785523</td>
      <td>1.336597</td>
      <td>-0.208642</td>
      <td>-2.173467</td>
      <td>-0.159574</td>
      <td>-0.201224</td>
      <td>-0.175144</td>
      <td>TCGA-D8-A1JU</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.321251</td>
      <td>-5.989832</td>
      <td>4.189945</td>
      <td>-0.206970</td>
      <td>0.171948</td>
      <td>0.960831</td>
      <td>-0.520194</td>
      <td>1.106246</td>
      <td>TCGA-AC-A3QQ</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.832310</td>
      <td>1.285090</td>
      <td>-0.477499</td>
      <td>-2.193931</td>
      <td>3.982175</td>
      <td>-0.967499</td>
      <td>-0.351455</td>
      <td>0.389307</td>
      <td>TCGA-C8-A12Q</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-5.633592</td>
      <td>3.690983</td>
      <td>-3.478281</td>
      <td>-0.803440</td>
      <td>0.446135</td>
      <td>0.610747</td>
      <td>-2.052404</td>
      <td>0.316239</td>
      <td>TCGA-AR-A1AY</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.174023</td>
      <td>1.517975</td>
      <td>0.166070</td>
      <td>2.912341</td>
      <td>0.421168</td>
      <td>-0.887175</td>
      <td>-1.127990</td>
      <td>-1.452414</td>
      <td>TCGA-A8-A0A2</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_to_analyze</span> <span class="o">=</span> <span class="n">optimal_pca_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Patient ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Cluster&#39;</span><span class="p">])</span>
<span class="n">features_to_analyze</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;PC1&#39;, &#39;PC2&#39;, &#39;PC3&#39;, &#39;PC4&#39;, &#39;PC5&#39;, &#39;PC6&#39;, &#39;PC7&#39;, &#39;PC8&#39;], dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cluster_stats</span> <span class="o">=</span> <span class="n">optimal_pca_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Cluster&#39;</span><span class="p">)[[</span><span class="s1">&#39;PC1&#39;</span><span class="p">,</span> <span class="s1">&#39;PC2&#39;</span><span class="p">,</span> <span class="s1">&#39;PC3&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Descriptive Statistics for Each Cluster:&quot;</span><span class="p">)</span>
<span class="n">cluster_stats</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Descriptive Statistics for Each Cluster:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="4" halign="left">PC1</th>
      <th colspan="4" halign="left">PC2</th>
      <th colspan="4" halign="left">PC3</th>
    </tr>
    <tr>
      <th></th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>max</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>max</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>max</th>
    </tr>
    <tr>
      <th>Cluster</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.422555</td>
      <td>2.669334</td>
      <td>-1.042854</td>
      <td>6.184113</td>
      <td>1.314811</td>
      <td>1.812225</td>
      <td>-2.445795</td>
      <td>3.785523</td>
      <td>0.226586</td>
      <td>1.816583</td>
      <td>-3.150876</td>
      <td>4.187933</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-1.346714</td>
      <td>2.241274</td>
      <td>-5.334288</td>
      <td>0.359772</td>
      <td>-3.703019</td>
      <td>2.310308</td>
      <td>-7.265999</td>
      <td>-1.123308</td>
      <td>-0.570986</td>
      <td>3.293631</td>
      <td>-5.974913</td>
      <td>4.189945</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-8.970442</td>
      <td>3.365790</td>
      <td>-12.364445</td>
      <td>-5.633592</td>
      <td>2.066320</td>
      <td>2.685685</td>
      <td>-1.033643</td>
      <td>3.690983</td>
      <td>0.199371</td>
      <td>3.280955</td>
      <td>-3.478281</td>
      <td>2.826122</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Overall Observations:</strong></p>
<ul class="simple">
<li><p>PC1 and PC2 seem to be more effective at differentiating the clusters based on their mean values than PC3</p></li>
</ul>
<p><strong>PC1 (Captures the most variance in your original data):</strong></p>
<ul class="simple">
<li><p>Separation (mean):</p>
<ul>
<li><p>PC1 strongly differentiates all three clusters based on their mean values</p></li>
<li><p>Cluster 0 has a positive mean (2.423), indicating samples here score high on the trait(s) PC1 represents</p></li>
<li><p>Cluster 1 has a moderately negative mean (-1.347)</p></li>
<li><p>Cluster 2 has a very strongly negative mean (-8.970), indicating samples in this cluster score very low on trait(s) PC1 represents</p></li>
</ul>
</li>
<li><p>Spread (std):</p>
<ul>
<li><p>Cluster 0 has an intermediate spread (std = 2.670)</p></li>
<li><p>Cluster 1 is the most compact (homogeneous) along PC1 (std = 2.241) relative to Cluster 0 and 2</p></li>
<li><p>Cluster 2 is the most spread out (heterogeneous) along PC1 (std = 3.366)</p></li>
</ul>
</li>
</ul>
<p><strong>PC2 (Captures the second most variance):</strong></p>
<ul class="simple">
<li><p>Separation (mean):</p>
<ul>
<li><p>PC2 is also effective at differentiating the clusters, particularly separating Cluster 1 from Clusters 0 and 2.</p></li>
<li><p>Cluster 1 has a strongly negative mean (-3.703).</p></li>
<li><p>Cluster 0 (1.315) and Cluster 2 (2.066) both have positive mean PC2 scores, with Cluster 2’s mean being slightly higher.</p></li>
</ul>
</li>
<li><p>Spread (std):</p>
<ul>
<li><p>Cluster 0 is the most compact along PC2 (std = 1.812).</p></li>
<li><p>Cluster 1 has an intermediate spread (std = 2.310).</p></li>
<li><p>Cluster 2 is the most spread out along PC2 (std = 2.686).</p></li>
</ul>
</li>
</ul>
<p><strong>Cluster 0:</strong></p>
<ul class="simple">
<li><p>Patients in this cluster strongly exhibit the characteristics represented by the positive direction of PC1 and moderately by the positive direction of PC2</p></li>
<li><p>They are quite consistent in their PC2 (and PC3) values</p></li>
</ul>
<p><strong>Cluster 1:</strong></p>
<ul class="simple">
<li><p>Patients are strongly characterized by the negative direction of PC2 and moderately by the negative direction of PC1</p></li>
<li><p>They are quite consistent in their PC1 values (relatively)</p></li>
</ul>
<p><strong>Cluster 2:</strong></p>
<ul class="simple">
<li><p>Patients are strongly characterized by the negative direction of PC1 and strongly by the strongly positive direction of PC2</p></li>
<li><p>They are quite spread-out in their PC1 and PC2 values</p></li>
</ul>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../4.DeepVariant/" class="btn btn-neutral float-left" title="DeepVariant: Deep-learning tool" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../2.Notebook_Logistic_regression/" class="btn btn-neutral float-right" title="Classification" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025 Norwegian Ai Cloud.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>